<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chameleon: Matrix Edition</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
    }
    
    body {
      background-color: #000;
      color: #0f0;
      overflow: hidden;
      height: 100vh;
      position: relative;
      line-height: 1.3;
    }
    
    /* Matrix rain effect */
    #matrix-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.50;
    }
    
    /* Home page container */
    #homePage {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 10px;
      text-align: center;
      position: relative;
    }
    
    /* Video background */
    #homeVideo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
      opacity: 1.5;
      filter: grayscale(100%) brightness(0.3) hue-rotate(90deg);
    }
    
    .home-content {
      position: relative;
      z-index: 2;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #0f0;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
      max-width: 90%;
      width: 600px;
    }
    
    .logo {
      font-size: 3rem;
      margin-bottom: 10px;
      text-shadow: 0 0 6px #0f0;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #0f0;
      text-shadow: 0 0 8px #0f0;
      animation: glitch 5s infinite;
    }
    
    @keyframes glitch {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }
    
    .tagline {
      font-size: 1rem;
      max-width: 400px;
      margin: 0 auto 15px;
      color: #0f0;
    }
    
    .instructions {
      background: rgba(0, 30, 0, 0.2);
      border: 1px solid #0f0;
      border-radius: 6px;
      padding: 12px;
      max-width: 400px;
      margin: 0 auto 15px;
      text-align: left;
      font-size: 0.85rem;
      position: relative;
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
    }
    
    .instructions h2 {
      margin-bottom: 8px;
      text-align: center;
      color: #0f0;
      font-size: 1.1rem;
    }
    
    .instructions ul {
      padding-left: 18px;
    }
    
    .instructions li {
      margin-bottom: 6px;
      color: #0f0;
    }
    
    .btn-start {
      padding: 10px 30px;
      font-size: 1rem;
      border: 2px solid #0f0;
      border-radius: 0;
      background: transparent;
      color: #0f0;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
    }
    
    .btn-start:hover {
      background: rgba(0, 255, 0, 0.1);
      box-shadow: 0 0 12px rgba(0, 255, 0, 0.2);
    }
    
    .btn-start:active {
      transform: translateY(2px);
    }
    
    /* Secret button */
    .secret-btn {
      position: absolute;
      width: 25px;
      height: 25px;
      background: rgba(0, 255, 0, 0.1);
      border: 1px solid #0f0;
      border-radius: 50%;
      cursor: pointer;
      opacity: 0;
      transition: all 0.5s;
      z-index: 10;
    }
    
    .secret-btn:hover {
      opacity: 1;
      background: rgba(0, 255, 0, 0.3);
      box-shadow: 0 0 8px #0f0;
    }
    
    /* Game page container */
    #gamePage {
      display: none;
      padding: 10px;
      height: 100vh;
    }
    
    .game-header {
      text-align: center;
      margin-bottom: 15px;
      padding: 10px;
      border-bottom: 1px solid #0f0;
    }
    
    .game-title {
      font-size: 1.5rem;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #0f0;
      text-shadow: 0 0 6px #0f0;
    }
    
    .game-subtitle {
      font-size: 0.85rem;
      color: #0f0;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .game-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .camera-section {
      flex: 1;
      min-width: 260px;
      background: rgba(0, 20, 0, 0.2);
      border: 1px solid #0f0;
      border-radius: 5px;
      padding: 10px;
    }
    
    .camera-container {
      position: relative;
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
    }
    
    video {
      width: 100%;
      border-radius: 5px;
      border: 1px solid #0f0;
      background: #000;
      display: block;
      margin: 0 auto;
    }
    
    canvas {
      display: none;
    }
    
    .detection-zone {
      position: absolute;
      top: 25%;
      left: 25%;
      width: 50%;
      height: 50%;
      border: 2px dashed #0f0;
      border-radius: 5px;
      pointer-events: none;
      box-shadow: 0 0 8px rgba(0, 255, 0, 0.2);
    }
    
    .instructions-panel {
      margin: 10px 0;
      padding: 10px;
      background: rgba(0, 30, 0, 0.2);
      border: 1px solid #0f0;
      border-radius: 5px;
      font-size: 0.8rem;
    }
    
    .instructions-panel h3 {
      margin-bottom: 6px;
      color: #0f0;
      text-align: center;
      font-size: 0.9rem;
    }
    
    .instructions-panel ul {
      padding-left: 16px;
    }
    
    .instructions-panel li {
      margin-bottom: 5px;
      color: #0f0;
    }
    
    .score-section {
      flex: 1;
      min-width: 260px;
      background: rgba(0, 20, 0, 0.2);
      border: 1px solid #0f0;
      border-radius: 5px;
      padding: 10px;
    }
    
    .score-title {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 12px;
      color: #0f0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .scoreboard {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }
    
    .score-item {
      display: flex;
      align-items: center;
      background: rgba(0, 30, 0, 0.2);
      padding: 10px;
      border: 1px solid #0f0;
      border-radius: 5px;
    }
    
    .score-color {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      margin-right: 10px;
      border: 2px solid;
    }
    
    .red .score-color {
      border-color: #f00;
      box-shadow: 0 0 6px rgba(255, 0, 0, 0.3);
      background: rgba(100, 0, 0, 0.2);
    }
    
    .blue .score-color {
      border-color: #00f;
      box-shadow: 0 0 6px rgba(0, 0, 255, 0.3);
      background: rgba(0, 0, 100, 0.2);
    }
    
    .score-info {
      flex-grow: 1;
      text-align: left;
    }
    
    .score-label {
      font-size: 0.9rem;
      margin-bottom: 2px;
      color: #0f0;
    }
    
    .counter {
      font-size: 1.7rem;
      font-weight: bold;
    }
    
    .red .counter {
      color: #f00;
      text-shadow: 0 0 6px rgba(255, 0, 0, 0.5);
    }
    
    .blue .counter {
      color: #00f;
      text-shadow: 0 0 6px rgba(0, 0, 255, 0.5);
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 12px;
    }
    
    .btn {
      padding: 6px 12px;
      font-size: 0.8rem;
      border: 1px solid #0f0;
      border-radius: 0;
      background: transparent;
      color: #0f0;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .btn:hover {
      background: rgba(0, 255, 0, 0.1);
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
    }
    
    .btn-home {
      background: rgba(0, 100, 0, 0.2);
    }
    
    .detection-info {
      margin-top: 12px;
      padding: 10px;
      background: rgba(0, 30, 0, 0.2);
      border: 1px solid #0f0;
      border-radius: 5px;
      font-size: 0.8rem;
      text-align: center;
    }
    
    .detection-text {
      margin-bottom: 6px;
      color: #0f0;
    }
    
    .detected-color {
      font-weight: bold;
      text-transform: uppercase;
      padding: 3px 10px;
      border-radius: 5px;
      margin: 0 3px;
      font-size: 0.9rem;
      display: inline-block;
    }
    
    .detected-red {
      background: rgba(100, 0, 0, 0.3);
      color: #f00;
      border: 1px solid #f00;
    }
    
    .detected-blue {
      background: rgba(0, 0, 100, 0.3);
      color: #00f;
      border: 1px solid #00f;
    }
    
    .motion-indicator {
      margin-top: 6px;
      color: #0f0;
      font-size: 0.8rem;
    }
    
    .motion-value {
      font-weight: bold;
      color: #0f0;
    }
    
    footer {
      position: absolute;
      bottom: 6px;
      left: 0;
      width: 100%;
      text-align: center;
      padding: 6px;
      color: #0f0;
      font-size: 0.7rem;
    }
    
    /* Risk clue elements */
    .risk-container {
      margin: 12px auto;
      max-width: 400px;
      text-align: center;
      border: 1px dashed #0f0;
      padding: 10px;
      border-radius: 5px;
      background: rgba(0, 30, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .risk-container:hover {
      background: rgba(0, 30, 0, 0.3);
      box-shadow: 0 0 12px rgba(0, 255, 0, 0.3);
    }
    
    .risk-message {
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: #0f0;
    }
    
    .risk-clue {
      font-size: 0.8rem;
      color: #0f0;
      opacity: 0.7;
      font-style: italic;
      transition: all 0.5s;
    }
    
    /* Visual effects */
    .matrix-particle {
      position: absolute;
      color: #0f0;
      font-size: 1rem;
      opacity: 0.7;
      animation: float linear forwards;
      z-index: -1;
    }
    
    @keyframes float {
      0% { transform: translateY(100vh) translateX(0); opacity: 0.7; }
      100% { transform: translateY(-100px) translateX(20px); opacity: 0; }
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      h1 {
        font-size: 1.6rem;
      }
      
      .game-title {
        font-size: 1.3rem;
      }
      
      .logo {
        font-size: 2.5rem;
      }
      
      .game-container {
        flex-direction: column;
      }
      
      .camera-section, .score-section {
        width: 100%;
      }
      
      .home-content {
        padding: 15px;
        max-width: 95%;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.4rem;
      }
      
      .tagline {
        font-size: 0.9rem;
      }
      
      .btn-start {
        padding: 8px 20px;
        font-size: 0.9rem;
      }
      
      .secret-btn {
        width: 20px;
        height: 20px;
        top: 10px;
        right: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Matrix background effect -->
  <canvas id="matrix-bg"></canvas>
  
  <!-- Home Page -->
  <div id="homePage">
    <!-- Video background -->
    <video id="homeVideo" autoplay muted loop playsinline>
      <source src="file:///C:/Users/prasa/Downloads/Animated_Matrix_Number_Video_Creation.mp4">
      Your browser does not support the video tag.
    </video>
    
    <div class="home-content">
      <div class="logo">🦎</div>
      <h1>Chameleon</h1>
      <p class="tagline">Color Detection System</p>
      
      <div class="instructions">
        <h2>System Directive</h2>
        <ul>
          <li>Detect moving red and blue objects</li>
          <li>Point objects at the detection zone</li>
          <li>Objects must be in motion to detect</li>
          <li>System has a hidden defect</li>
          <li>Find the secret access point</li>
        </ul>
      </div>
      
      <div class="risk-container" id="riskContainer">
        <div class="risk-message">You won't reach the right destination if you don't take the risk</div>
        <div class="risk-clue" id="riskClue">The path to truth is not always visible. Sometimes you must take a leap of faith into the unknown.</div>
      </div>
      
      <button id="mainStartBtn" class="btn-start">Initiate System</button>
    </div>
    
    <!-- Secret button - hidden in the corner -->
    <button id="secretStartBtn" class="secret-btn" title="Secret Access Point" style="top: 10px; right: 10px;"></button>
  </div>
  
  <!-- Game Page -->
  <div id="gamePage">
    <div class="game-header">
      <h1 class="game-title">Chameleon Active</h1>
      <p class="game-subtitle">Detecting moving objects - Status: <span id="systemStatus">DEFECTIVE</span></p>
    </div>
    
    <div class="game-container">
      <div class="camera-section">
        <h2>CAMERA FEED</h2>
        
        <div class="camera-container">
          <video id="video" autoplay playsinline></video>
          <canvas id="canvas"></canvas>
          <div class="detection-zone"></div>
        </div>
        
        <div class="instructions-panel">
          <h3>INSTRUCTIONS</h3>
          <ul>
            <li>Allow camera access when prompted</li>
            <li>Move colored objects in detection zone</li>
            <li>Red and blue objects counted</li>
            <li>Static objects not detected</li>
          </ul>
        </div>
      </div>
      
      <div class="score-section">
        <h2 class="score-title">RESULTS</h2>
        
        <div class="scoreboard">
          <div class="score-item red">
            <div class="score-color">🔴</div>
            <div class="score-info">
              <div class="score-label">Red Objects</div>
              <div class="counter" id="redScore">0</div>
            </div>
          </div>
          
          <div class="score-item blue">
            <div class="score-color">🔵</div>
            <div class="score-info">
              <div class="score-label">Blue Objects</div>
              <div class="counter" id="blueScore">0</div>
            </div>
          </div>
        </div>
        
        <div class="detection-info">
          <div class="detection-text">
            Detection: 
            <span class="detected-color detected-red" id="currentColor">NONE</span>
          </div>
          <div class="motion-indicator">
            Motion: <span class="motion-value" id="motionValue">0%</span>
          </div>
        </div>
        
        <div class="controls">
          <button class="btn btn-home" onclick="backToHome()">Terminate</button>
          <button class="btn" onclick="resetGame()">Reset</button>
        </div>
      </div>
    </div>
    
    <footer>
      Chameleon System v2.3.7 | Status: <span id="statusIndicator">Operational</span>
    </footer>
  </div>

  <script>
    // Matrix background effect
    const canvas = document.getElementById('matrix-bg');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    
    resizeCanvas();
    
    const chars = "01";
    const charArr = chars.split("");
    const fontSize = 12;
    let columns = canvas.width / fontSize;
    const drops = [];
    
    for(let i = 0; i < columns; i++) {
      drops[i] = Math.floor(Math.random() * canvas.height);
    }
    
    function drawMatrix() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.04)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.fillStyle = "#0f0";
      ctx.font = fontSize + "px monospace";
      
      for(let i = 0; i < drops.length; i++) {
        const text = charArr[Math.floor(Math.random() * charArr.length)];
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        
        if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }
    
    setInterval(drawMatrix, 33);
    
    // Create floating matrix particles
    function createMatrixParticles() {
      setInterval(() => {
        const particle = document.createElement('div');
        particle.classList.add('matrix-particle');
        particle.textContent = Math.random() > 0.5 ? '0' : '1';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.animationDuration = `${Math.random() * 5 + 3}s`;
        document.body.appendChild(particle);
        
        // Remove after animation completes
        setTimeout(() => {
          particle.remove();
        }, 5000);
      }, 300);
    }
    
    // Game state
    let gameInterval;
    let scores = { Red: 0, Blue: 0 };
    let lastFrame = null;
    let motionDetected = false;
    let motionLevel = 0;
    let defectiveMode = true;
    
    // DOM elements
    const video = document.getElementById('video');
    const canvasEl = document.getElementById('canvas');
    const ctxEl = canvasEl.getContext('2d');
    const currentColorElement = document.getElementById('currentColor');
    const motionValueElement = document.getElementById('motionValue');
    const homePage = document.getElementById('homePage');
    const gamePage = document.getElementById('gamePage');
    const systemStatus = document.getElementById('systemStatus');
    const statusIndicator = document.getElementById('statusIndicator');
    const mainStartBtn = document.getElementById('mainStartBtn');
    const secretStartBtn = document.getElementById('secretStartBtn');
    const riskContainer = document.getElementById('riskContainer');
    const riskClue = document.getElementById('riskClue');
    
    // Event listeners
    mainStartBtn.addEventListener('click', () => {
      defectiveMode = true;
      systemStatus.textContent = "DEFECTIVE";
      systemStatus.style.color = "#f00";
      startGame();
    });
    
    secretStartBtn.addEventListener('click', () => {
      defectiveMode = false;
      systemStatus.textContent = "FULL ACCESS";
      systemStatus.style.color = "#0f0";
      startGame();
    });
    
    // Risk clue interaction
    riskContainer.addEventListener('click', () => {
      riskClue.textContent = "The secret lies in the corner where conformity reigns. Dare to explore beyond the obvious.";
      riskClue.style.opacity = "1";
      riskClue.style.color = "#0f0";
      
      // Reveal secret button after a delay
      setTimeout(() => {
        secretStartBtn.style.opacity = "0.8";
        secretStartBtn.style.boxShadow = "0 0 10px #0f0";
        riskClue.textContent = "The secret button has been revealed in the top-right corner!";
      }, 2000);
    });
    
    // Start the game
    function startGame() {
      homePage.style.display = 'none';
      gamePage.style.display = 'block';
      initGame();
    }
    
    // Back to home page
    function backToHome() {
      gamePage.style.display = 'none';
      homePage.style.display = 'flex';
      stopGame();
      resetGame();
    }
    
    // Reset the game
    function resetGame() {
      scores = { Red: 0, Blue: 0 };
      document.getElementById('redScore').textContent = '0';
      document.getElementById('blueScore').textContent = '0';
      lastFrame = null;
      motionDetected = false;
      motionLevel = 0;
      motionValueElement.textContent = "0%";
      updateCurrentColor("NONE");
    }
    
    // Stop the game
    function stopGame() {
      if (gameInterval) {
        clearInterval(gameInterval);
        gameInterval = null;
      }
      
      if (video.srcObject) {
        const tracks = video.srcObject.getTracks();
        tracks.forEach(track => track.stop());
        video.srcObject = null;
      }
    }
    
    // Initialize the game
    function initGame() {
      // Ask for camera access
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          
          // When video metadata is loaded, set canvas size
          video.addEventListener('loadedmetadata', () => {
            canvasEl.width = video.videoWidth;
            canvasEl.height = video.videoHeight;
            startDetection();
          });
        })
        .catch(err => {
          console.error("Camera error:", err);
          statusIndicator.textContent = "Camera Error";
          statusIndicator.style.color = "#f00";
        });
    }
    
    // Start color detection
    function startDetection() {
      gameInterval = setInterval(detectColor, 300);
      statusIndicator.textContent = "Operational";
      statusIndicator.style.color = "#0f0";
    }
    
    // Detect color and motion
    function detectColor() {
      if (video.readyState !== video.HAVE_ENOUGH_DATA) return;
      
      // Draw video frame to canvas
      ctxEl.drawImage(video, 0, 0, canvasEl.width, canvasEl.height);
      
      // Define detection zone (center 50%)
      const zoneWidth = canvasEl.width * 0.5;
      const zoneHeight = canvasEl.height * 0.5;
      const zoneX = (canvasEl.width - zoneWidth) / 2;
      const zoneY = (canvasEl.height - zoneHeight) / 2;
      
      // Get image data from detection zone
      const frame = ctxEl.getImageData(zoneX, zoneY, zoneWidth, zoneHeight);
      const data = frame.data;
      
      // Motion detection - compare with previous frame
      motionDetected = false;
      motionLevel = 0;
      
      if (lastFrame) {
        let diff = 0;
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          
          const prevR = lastFrame[i];
          const prevG = lastFrame[i + 1];
          const prevB = lastFrame[i + 2];
          
          const pixelDiff = Math.abs(r - prevR) + Math.abs(g - prevG) + Math.abs(b - prevB);
          diff += pixelDiff;
        }
        
        // Calculate motion level (0-100%)
        motionLevel = Math.min(100, Math.floor(diff / (data.length / 4) / 10));
        motionValueElement.textContent = motionLevel + "%";
        
        // Consider motion detected if above threshold
        motionDetected = motionLevel > 8;
      }
      
      // Store current frame for next comparison
      lastFrame = new Uint8ClampedArray(data);
      
      // Only proceed with color detection if motion is detected
      if (!motionDetected) {
        updateCurrentColor("NONE");
        return;
      }
      
      // Color detection - highly sensitive
      let r = 0, g = 0, b = 0, total = 0;
      
      // Sample every 4th pixel for performance
      for (let i = 0; i < data.length; i += 16) {
        r += data[i];
        g += data[i + 1];
        b += data[i + 2];
        total++;
      }
      
      // Calculate average color in detection zone
      r = Math.round(r / total);
      g = Math.round(g / total);
      b = Math.round(b / total);
      
      // Determine dominant color with very low thresholds
      let color = "None";
      
      // Very low threshold for sensitivity
      const minDiff = 10;
      
      // Detect red if red is higher than green and blue
      if (r > g && r > b) {
        color = "Red";
      } 
      // Detect blue if blue is higher than red and green
      else if (b > r && b > g) {
        color = "Blue";
      }
      
      // Update UI with current detection
      updateCurrentColor(color);
      
      // Update scores based on mode
      if (color !== "None") {
        if (defectiveMode) {
          // Defective mode - only increment blue counter
          scores.Blue++;
          document.getElementById('blueScore').textContent = scores.Blue;
        } else {
          // Fully functional mode
          scores[color]++;
          document.getElementById('redScore').textContent = scores.Red;
          document.getElementById('blueScore').textContent = scores.Blue;
        }
      }
    }
    
    // Update current color display
    function updateCurrentColor(color) {
      currentColorElement.textContent = color;
      
      // Update styling based on detected color
      currentColorElement.className = "detected-color";
      if (color === "Red") {
        currentColorElement.classList.add("detected-red");
      } else if (color === "Blue") {
        currentColorElement.classList.add("detected-blue");
      }
    }
    
    // Handle window resize
    window.addEventListener('resize', () => {
      resizeCanvas();
      columns = canvas.width / fontSize;
      
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvasEl.width = video.videoWidth;
        canvasEl.height = video.videoHeight;
      }
    });
    
    // Start particle animation
    createMatrixParticles();
  </script>
</body>
</html>