<!DOCTYPE html>
<html>
<head>
  <title>MATRIX</title>
  <style>
    @font-face {
      font-family: 'MyCustomFont';
      src: url('fonts/MyCustomFont-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: sans-serif;
      text-align: center;
      background-image: url("SITEBG2.png");
      background-size: 100% 150%;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .container {
      margin-top: 20%;
    }
    button {
      padding: 15px 30px;
      font-size: 1.2em;
      border: none;
      border-radius: 10px;
      background: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #218838;
    }
    /* Game section */
    #gameSection {
      display: none;
    }
    video, canvas {
      display: inline-block;
      margin: 10px auto;
      border: 4px solid white;
    }
    .scoreboard {
      margin-top: 20px;
      font-size: 1.2em;
    }
    .scoreboard span {
      display: inline-block;
      margin: 0 15px;
    }
  </style>
</head>
<body>

  <!-- First screen -->
  <div id="startSection" class="container">
    <h1 style="font-family: fantasy">ðŸŽ¯ RED CAR BLUE CAR</h1>
    <p>Click the button below to start the game!</p>
    <button onclick="startGame()">Start Game</button>
  </div>

  <!-- Second screen (game) -->
  <div id="gameSection">
    <h1>ðŸŽ¯ Colour Counter Game</h1>

    <!-- Camera feed -->
    <video id="video" width="320" height="240" autoplay></video>
  
    <!-- Canvas for processing frames (hidden) -->
    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
  
    <!-- Scoreboard -->
    <div class="scoreboard">
      <span>ðŸ”´ Red: <b id="redScore">0</b></span>
      <span>ðŸŸ¢ Green: <b id="greenScore">0</b></span>
      <span>ðŸ”µ Blue: <b id="blueScore">0</b></span>
    </div>
  </div>

  <script>
    function startGame() {
      document.getElementById('startSection').style.display = 'none';
      document.getElementById('gameSection').style.display = 'block';
      initGame();
    }

    function initGame() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      let scores = { Red: 0, Green: 0, Blue: 0 };

      // Ask for camera access
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
        })
        .catch(err => {
          console.error("Camera error:", err);
          alert("Unable to access camera. Please allow permissions.");
        });

      function getMajorityColor() {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = frame.data;

        let r = 0, g = 0, b = 0, total = 0;

        for (let i = 0; i < data.length; i += 4) {
          r += data[i];
          g += data[i + 1];
          b += data[i + 2];
          total++;
        }

        r /= total; g /= total; b /= total;

        let color;
        if (r > g && r > b) color = "Red";
        else if (g > r && g > b) color = "Green";
        else color = "Blue";

        scores[color]++;
        document.getElementById('redScore').textContent = scores.Red;
        document.getElementById('greenScore').textContent = scores.Green;
        document.getElementById('blueScore').textContent = scores.Blue;
      }

      // Check every 500ms
      setInterval(getMajorityColor, 500);
    }
  </script>
</body>
</html>